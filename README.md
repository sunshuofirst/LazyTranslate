# LazyTranslate - 智能网页翻译扩展

一个简单的Chrome浏览器翻译扩展，支持自定义词库和多种翻译API。

## 功能特性

### 🎯 核心功能
- **翻译**: 支持整个页面或交互式区域选择翻译
- **自定义词库**: 添加常用词汇的精准翻译，支持JSON格式的词库导入导出功能
- **多API支持**: 谷歌翻译、腾讯翻译、百度翻译
- **右键菜单**: 快速访问翻译功能
- **字体联动**: 目标语言与字体智能联动
- **词库管理**: 支持JSON格式的词库导入导出功能

### 🔧 详细功能

1. **插件主页面 (Popup)**
   - 原语言设置（默认自动识别）
   - 目标语言设置（默认浏览器语言）
   - 目标语言字体设置（与目标语言联动）
   - 翻译API选择（谷歌/腾讯/百度）
   - 自定义词库管理

2. **右键菜单功能**
   - LazyTranslate - 翻译当前页面：翻译整个网页内容
   - LazyTranslate - 翻译选中内容：交互式选择区域进行翻译
   - LazyTranslate - 显示网页原文：恢复页面的原始内容
   - LazyTranslate - 自定义单词：打开插件主页面

3. **交互式区域选择翻译**
   - 点击后进入区域选择模式
   - 鼠标移动时动态显示当前区域边框（使用固定定位，支持页面滚动）
   - 点击左键选择要翻译的区域
   - 按ESC键退出选择模式
   - 实时翻译进度显示

4. **字体联动功能**
   - 目标语言与字体智能联动
   - 选择中文时显示中文字体选项
   - 选择英文时显示英文字体选项
   - 支持多种语言的专用字体
   - 翻译后自动应用选择的字体

5. **自定义词库**
   - 添加/删除常用词汇
   - 键值对形式存储
   - 本地chrome.storage.local存储
   - **新增**: 支持词库的导入导出功能
     - **导出词库**: 将自定义词库导出为UTF-8编码的JSON文件，文件名包含时间戳
     - **导入词库**: 从JSON文件导入词库，支持格式验证和重复词汇处理
     - **格式验证**: 导入时验证文件类型和JSON格式的有效性
     - **重复处理**: 检测重复词汇，提供覆盖或跳过选项
     - **错误处理**: 完善的错误提示和异常处理机制
     - **批量管理**: 方便用户备份、迁移和分享词库

6. **翻译流程**
   - 优先应用自定义词库替换
   - 调用选择的翻译API
   - 批量处理避免API限制
   - 实时进度显示
   - 应用选择的字体样式

7. **原文恢复功能**
   - 保存页面原始内容
   - 一键恢复原文显示
   - 保持页面滚动位置

## 安装说明

### 开发者模式安装

1. 下载或克隆此项目到本地
2. 打开Chrome浏览器，进入 `chrome://extensions/`
3. 开启右上角的"开发者模式"
4. 点击"加载已解压的扩展程序"
5. 选择项目文件夹
6. 扩展安装完成

### 图标文件

在 `icons/` 文件夹中需要放置以下图标文件：
- `icon16.png` (16x16像素)
- `icon48.png` (48x48像素)  
- `icon128.png` (128x128像素)

## 使用指南

### 基本使用

1. **首次使用**
   - 点击浏览器工具栏中的扩展图标
   - 设置原语言和目标语言
   - 选择翻译API（谷歌翻译无需密钥）

2. **翻译页面**
   - 方法1：右键点击页面 → "LazyTranslate - 翻译当前页面"
   - 方法2：在插件主页面点击"翻译当前页面"

3. **交互式区域选择翻译**
   - 右键点击页面 → "LazyTranslate - 翻译选中区域"
   - 移动鼠标，观察不同区域的边框高亮效果
   - 点击想要翻译的区域（如某个段落或div）
   - 观察翻译进度和结果
   - 按ESC键可以退出选择模式

4. **显示网页原文**
   - 右键点击页面 → "LazyTranslate - 显示网页原文"
   - 恢复页面的原始内容（如果页面已被翻译）

### 字体设置

1. **字体联动**
   - 选择目标语言后，字体选项自动更新
   - 中文：微软雅黑、宋体、黑体、苹方等
   - 英文：Arial、Times New Roman、Helvetica等
   - 日语：ヒラギノ角ゴ、游ゴシック等
   - 韩语：맑은 고딕、나눔고딕等

2. **字体应用**
   - 翻译完成后自动应用选择的字体
   - 支持页面翻译和区域翻译
   - 字体设置会保存到本地存储

### 自定义词库

1. **添加词汇**
   - 打开插件主页面
   - 在"自定义词库"区域输入原词和翻译
   - 点击"添加词汇"

2. **管理词库**
   - 查看已添加的词汇列表
   - 点击"删除"按钮移除不需要的词汇
   - 点击"清空词库"删除所有词汇
   - 点击"导入词库"从文件导入词汇
   - 点击"导出词库"将词库导出为文件

### API配置

1. **谷歌翻译**（默认，无需配置）
   - 免费使用，无需API密钥

2. **微软翻译**
   - 需要腾讯翻译API密钥
   - 格式：`SecretId:SecretKey`
   - 在插件中配置API密钥

3. **百度翻译**
   - 需要百度翻译API密钥
   - 格式：`appid:secret`
   - 在插件中配置API密钥

## 技术架构

### 文件结构
```
LazyTranslate/
├── manifest.json              # 扩展配置文件
├── popup.html                 # 主页面HTML
├── popup.css                  # 主页面样式
├── popup.js                   # 主页面逻辑
├── background.js              # 后台脚本
├── content.js                 # 内容脚本
├── selectElement.js           # 元素选择器
├── icons/                     # 图标文件夹
│   ├── icon16.png
│   ├── icon48.png
│   └── icon128.png
└── README.md                  # 说明文档
```

### 核心组件

1. **manifest.json**: 扩展配置，定义权限和脚本
2. **popup.html/js/css**: 插件主界面
3. **background.js**: 后台服务，处理API调用和右键菜单
4. **content.js**: 页面内容脚本，处理翻译逻辑
5. **selectElement.js**: 元素选择器，处理区域选择和高亮显示

### 数据存储

- **chrome.storage.local**: 存储用户设置和自定义词库
- **设置数据**: 语言配置、API选择、API密钥、字体设置
- **自定义词库**: 原词-翻译键值对

## 开发说明

### 权限说明

- `storage`: 本地数据存储
- `activeTab`: 访问当前标签页
- `contextMenus`: 创建右键菜单
- `scripting`: 脚本注入
- `host_permissions`: API域名访问权限

### API集成

1. **谷歌翻译**: 使用免费API端点
2. **腾讯翻译**: 腾讯翻译API
3. **百度翻译**: 百度翻译开放平台API

### 翻译流程

1. 获取自定义词库
2. 遍历页面文本节点
3. 应用自定义词库替换
4. 批量调用翻译API
5. 更新页面内容

### 字体实现机制

1. **CSS Class 应用**
   - 为翻译元素添加 `lazytranslate-font-applied` class
   - 动态注入 CSS 样式规则到页面头部
   - 使用 `!important` 确保字体优先级

2. **样式管理**
   - 创建 `<style id="lazytranslate-font-style">` 元素
   - 定义字体样式规则
   - 支持递归应用到所有子元素

3. **智能清理**
   - 显示原文时移除字体 class
   - 删除动态注入的样式元素
   - 恢复原始字体显示

4. **重新应用**
   - 重新翻译时自动重新应用字体设置
   - 保持字体配置的一致性

### 区域选择翻译流程

1. 启动区域选择模式
2. 使用ElementSelector类管理选择状态
3. 监听鼠标移动事件，动态更新边框指示器
4. 监听点击事件选择目标区域
5. 获取选中区域内的所有文本节点
6. 批量翻译文本节点
7. 显示翻译进度和结果
8. 应用字体设置

### 字体联动技术细节

**字体联动功能实现了以下特性：**

1. **动态字体配置**:
   - 按语言分类的字体配置对象
   - 每种语言包含专用字体选项
   - 自动包含"默认字体"选项

2. **联动逻辑**:
   - 目标语言变化时自动更新字体选项
   - 保持用户之前选择的字体（如果可用）
   - 异步加载和保存设置

3. **字体应用**:
   - 翻译完成后自动应用字体
   - 支持页面翻译和区域翻译
   - 递归应用到所有子元素

4. **设置持久化**:
   - 字体选择保存到本地存储
   - 重新打开弹窗时恢复设置
   - 跨会话保持用户偏好

## 注意事项

1. **API限制**: 避免频繁调用，已实现批量处理和延迟
2. **跨域请求**: 通过background.js处理API调用
3. **性能优化**: 只翻译文本节点，避免修改HTML结构
4. **错误处理**: 完善的错误提示和异常处理
5. **区域选择**: 支持嵌套元素，智能识别可翻译区域
6. **页面滚动**: 新的元素选择器支持页面滚动，边框指示器始终正确定位
7. **字体兼容性**: 字体设置基于系统可用字体，确保兼容性

## 许可证

MIT License

## 贡献

欢迎提交Issue和Pull Request来改进这个扩展！

## 联系方式

如有问题或建议，请通过GitHub Issues联系。

## 测试步骤

1. **基本功能测试**
   - 打开 `test_page.html`
   - 右键选择"LazyTranslate - 翻译此页面"
   - 检查页面是否被翻译

2. **区域选择翻译测试**
   - 打开 `test_area_selection.html`
   - 右键选择"LazyTranslate - 翻译此区域"
   - 移动鼠标观察区域高亮效果
   - 点击不同区域测试翻译功能
   - 按ESC键测试退出功能

3. **原文显示测试**
   - 打开 `test_original.html`
   - 先翻译页面，再显示原文
   - 检查原文恢复是否正确

4. **自定义词库测试**
   - 在插件主页面添加测试词汇
   - 翻译包含该词汇的页面
   - 检查自定义翻译是否生效

5. **字体联动测试**
   - 打开 `test_font_linking.html`
   - 选择不同语言，观察字体变化
   - 检查翻译后字体是否正确应用
   - 翻译包含该语言的页面
   - 检查字体设置是否持久化保存

## 📚 词库导入导出功能详解

### 功能概述
LazyTranslate 支持自定义词库的导入导出功能，让用户可以方便地备份、迁移和分享自己的词库。

### 使用方法

#### 导出词库
1. 打开 LazyTranslate 扩展弹窗
2. 滚动到"自定义词库"部分
3. 点击"导出词库"按钮
4. 浏览器会自动下载一个 JSON 格式的词库文件
5. 文件名格式：`LazyTranslate_词库_YYYY-MM-DDTHH-MM-SS.json`

#### 导入词库
1. 打开 LazyTranslate 扩展弹窗
2. 滚动到"自定义词库"部分
3. 点击"导入词库"按钮
4. 选择要导入的 JSON 文件
5. 系统会自动验证文件格式
6. 如果发现重复词汇，会提示选择处理方式：
   - **覆盖**：用导入的词汇覆盖现有词汇
   - **跳过**：保留现有词汇，跳过重复的导入词汇

### 文件格式
词库文件采用标准的 JSON 格式，UTF-8 编码：

```json
{
  "hello": "你好",
  "world": "世界",
  "translate": "翻译",
  "extension": "扩展",
  "browser": "浏览器"
}
```

#### 格式要求
- 文件必须是有效的 JSON 格式
- 文件编码必须是 UTF-8
- 所有键和值都必须是字符串类型
- 不支持嵌套对象或数组

### 错误处理
系统提供完善的错误检测和提示：

1. **文件类型检查**：只接受 `.json` 扩展名的文件
2. **JSON 格式验证**：检查文件是否为有效的 JSON
3. **数据类型验证**：确保所有词条都是字符串类型
4. **空词库检查**：导出时检查是否有词汇可导出
5. **重复词汇处理**：智能检测并提供处理选项

### 使用场景
- **备份词库**：定期导出词库文件进行备份
- **迁移数据**：在不同设备间迁移词库
- **分享词库**：与他人分享专业词汇表
- **批量导入**：从其他翻译工具导入词库

### 示例文件
项目中包含 `sample_words.json` 示例文件，您可以用它测试导入功能。

### 测试页面
访问 `testpages/import_export_test.html` 可查看详细的测试说明和使用指南。